-- =========================================================
-- СОГЛАСИЯ / СНИМОК СООТВЕТСТВИЯ
-- =========================================================
CREATE TABLE IF NOT EXISTS
  order_consents (
    -- Уникальный идентификатор заказа; внешний ключ на orders.id.
    -- При удалении заказа запись согласия удаляется каскадно.
    order_id uuid PRIMARY KEY REFERENCES orders (id) ON DELETE CASCADE,
    -- Версия условий использования (Terms of Service), принятых пользователем
    -- в момент оформления заказа (например, "v1.3" или хеш версии).
    tos_version text,
    -- Версия политики конфиденциальности, согласованной пользователем
    -- в момент оформления заказа.
    privacy_version text,
    -- Согласие на маркетинговые коммуникации (рассылки, акции и т.п.).
    -- Обязательное поле; по умолчанию — false (согласия нет).
    marketing_opt_in boolean NOT NULL DEFAULT false,
    -- IP-адрес, с которого было дано согласие; тип inet.
    consent_ip inet,
    -- User-Agent клиента/браузера на момент предоставления согласия.
    consent_user_agent text,
    -- Временная метка момента согласия с учётом часового пояса (timestamptz).
    -- Обязательное поле; по умолчанию — текущее время now().
    consented_at timestamptz NOT NULL DEFAULT now()
  );
