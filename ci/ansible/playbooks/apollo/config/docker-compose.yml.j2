services:
  router-admin:
    image: ghcr.io/shopanaio/apollo-router:${APOLLO_ROUTER_TAG:-latest}
    ports:
      - "{{ apollo_router_admin_port }}:{{ apollo_router_admin_port }}"
      - "{{ apollo_router_admin_health_port }}:{{ apollo_router_admin_health_port }}"
    volumes:
      - ./config/router-admin.yaml:/dist/config/router.yaml:ro
      - ./config/supergraph-admin.graphql:/dist/schema/supergraph.graphql:ro
    environment:
      APOLLO_ROUTER_CONFIG_PATH: /dist/config/router.yaml
      APOLLO_ROUTER_SUPERGRAPH_PATH: /dist/schema/supergraph.graphql
      APOLLO_ELV2_LICENSE: accept
    command:
      - --supergraph
      - /dist/schema/supergraph.graphql
      - --config
      - /dist/config/router.yaml

  router-storefront:
    image: ghcr.io/shopanaio/apollo-router:${APOLLO_ROUTER_TAG:-latest}
    ports:
      - "{{ apollo_router_storefront_port }}:{{ apollo_router_storefront_port }}"
      - "{{ apollo_router_storefront_health_port }}:{{ apollo_router_storefront_health_port }}"
    volumes:
      - ./config/router-storefront.yaml:/dist/config/router.yaml:ro
      - ./config/supergraph-storefront.graphql:/dist/schema/supergraph.graphql:ro
    environment:
      APOLLO_ROUTER_CONFIG_PATH: /dist/config/router.yaml
      APOLLO_ROUTER_SUPERGRAPH_PATH: /dist/schema/supergraph.graphql
      APOLLO_ELV2_LICENSE: accept
    command:
      - --supergraph
      - /dist/schema/supergraph.graphql
      - --config
      - /dist/config/router.yaml
